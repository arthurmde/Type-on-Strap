---
layout: post
title: "Criando um blog em Jekyll multil√≠ngue com separa√ß√£o de conte√∫do, pagina√ß√£o e feeds"
lang-ref: jekyll-i18n
locale: pt-br
feature-img: "assets/img/pexels/i18n.jpeg"
thumbnail: "assets/img/thumbnails/i18n.jpeg"
categories:
  - Hacking
  - Jekyll
tags:
  - ruby
  - jekyll
  - i18n
  - writing
excerpt_separator: <!--more-->
---

N√£o √© dif√≠cil estruturar o seu site [Jekyll](https://jekyllrb.com/)
para produzir conte√∫dos em v√°rias l√≠nguas diferentes. Acabei de fazer isso com
o meu site pessoal e vou explicar aqui nesse post as principais etapas que
realizei.

<!--more-->

Jekyll √© um gerador de sites est√°ticos muito simples que facilita o
desenvolvimento de p√°ginas pessoais e blogs como este aqui. Recentemente eu
estava muito interessado em produzir conte√∫dos n√£o s√≥ em ingl√™s, mas tamb√©m
em portugu√™s, minha l√≠ngua nativa. Ent√£o, pesquisei algumas formas de
estender o Jekyll para suportar mais de uma l√≠ngua. Meus principais objetivos
foram:
* Poder ter um blog separado em Portugu√™s e outro em Ingl√™s
* Poder escrever artigos somente para um desses blogs (ex: um texto somente
em portugu√™s, tal como este aqui).
* Poder escrever artigos que fossem equivalentes nas duas l√≠nguas. Esses artigos
precisam ter links para suas tradu√ß√µes em outras l√≠nguas.
* Separar o Feed RSS por l√≠ngua.
* Ter a tradu√ß√£o de outras p√°ginas do site, como a minha p√°gina [Sobre](/pt-br/about)
* Permitir ao usu√°rio escolher a l√≠ngua que ele deseja visualizar no site.


Apesar da exist√™ncia de alguns plugins, a melhor abordagem que encontrei foi a descrita por
DJ Walker [nesse artigo](https://forestry.io/blog/creating-a-multilingual-blog-with-jekyll/),
onde ele explora a simplicidade das estruturas de pastas do Jekyll e os
mecanismos de [Front Matter](https://jekyllrb.com/docs/front-matter/)
para construir um site internacionaliz√°vel onde fosse f√°cil construir novas
p√°ginas e referenciar p√°ginas equivalentes traduzidas em outras l√≠nguas.
Recomendo a leitura antes de seguir aqui, principalmente pois o texto
dele discute maiores detalhes.

Sendo assim, resolvi focar nos passos cruciais e adicionar algumas etapas que
ele n√£o cobriu que podem ser √∫teis para outras pessoas tamb√©m, tais como
produzir feeds RSS separadas para cada l√≠ngua e considerar pagina√ß√£o do seu
blog.

## Configura√ß√£o

Antes de come√ßar, eu instalei dois plugins:
- [jekyll-paginate-v2](https://github.com/sverrirs/jekyll-paginate-v2) - para pagina√ß√£o dos artigos no blog
- [jekyll-redirect-from](https://github.com/jekyll/jekyll-redirect-from) - para redirecionar a p√°gina inicial para a p√°gina
inicial da l√≠ngua padr√£o do site

Veja a documenta√ß√£o no [site do Jekyll de como instalar plugins](https://jekyllrb.com/docs/plugins/).

Adicione as seguintes configura√ß√µes no arquivo *_config.yml*:

```yml
# Localization
lang: 'en' # L√≠ngua padr√£o
languages: ["en", "pt-br"] # L√≠nguas dispon√≠veis
languageNames:
  en: English
  pt-br: Portugu√™s (BR)

# PAGINATION
pagination:
  enabled: true
  per_page: 5
  paginate_path: "/page/:num/"
  collection: 'posts'
  category: 'posts'
  sort_reverse: true
```


## Estrutura

A primeira etapa consiste em separar as pastas do seu projeto por l√≠ngua:

```sh
_includes/
_layouts/
en/
  _posts/
    2018-08-02-debcamp18.md
    2019-04-15-ruby-initialize-objects-with-a-hash.md
  index.html
  feed.xml
  about.md
pt-br/
  _posts/
    2019-04-15-ruby-initialize-objects-with-a-hash.md
  index.html
  feed.xml
  about.md
public/
_config.yml
```

Essa estrutura adiciona um *namespace* na URL das suas p√°ginas que indica a
l√≠ngua do conte√∫do. Por exemplo:
* P√°gina principal em Ingl√™s - <https://arthurmde.me/en/>
* P√°gina principal em Portugu√™s - <https://arthurmde.me/pt-br/>
* P√°gina 'Sobre' em Ingl√™s - <https://arthurmde.me/en/about.html>
* P√°gina 'Sobre' em Portugu√™s - <https://arthurmde.me/pt-br/about.html>

## Metadados nas P√°ginas

Dentro de cada p√°gina n√≥s iremos usar o Front Matter para adicionar metadados
relacionados √† l√≠ngua que est√° sendo utilizada por ela. Por enquanto, a
√∫nica chave adicionada ser√° *locale* que indicar√° a l√≠ngua do conte√∫do da
p√°gina. Ou seja, todas as p√°ginas dentro da pasta *en* ter√£o `locale: en`,
enquanto as p√°ginas dentro de *pt-br* ter√£o `locale: pt-br`.

*en/about.md*

```
---
layout: profile
title: About
locale: en
---
```

*pt-br/about.md*

```
---
layout: profile
title: Sobre
locale: pt-br
---
```

## Dados e Configura√ß√£o

Crie uma pasta nova chamada *_data*:

```shell
mkdir _data
```

Dentro dela, vamos criar dois arquivos:
* **languages.yml** - arquivo que ir√° conter alguns dados gerais sobre as
l√≠nguas dispon√≠veis no site que podemos referenciar nas p√°ginas. Por exemplo,
no meu caso, cont√©m o nome da l√≠ngua e um [emoji unicode](http://www.unicode.org/emoji/charts/full-emoji-list.html)
da bandeira referente ao pa√≠s que fala aquela l√≠ngua.

*_data/languages.yml*

```yml
en:
  label: English
  icon: üá∫üá∏
pt-br:
  label: Portugu√™s (BR)
  icon: üáßüá∑
```

* **translations.yml** - arquivo que ir√° conter tradu√ß√µes de algumas strings
que estar√£o presentes em arquivos gen√©ricos que n√£o est√£o inclusos dentro das
pastas de l√≠nguas dispon√≠veis, tais como os arquivos das pastas *_includes*
e *_layouts*.

*_data/translations.yml*

```yml
related-posts:
  en: "Related Posts"
  pt-br: "Artigos Relacionados"
different-language:
  en: "Read this page in a different language"
  pt-br: "Leia esta p√°gina em um idioma diferente"
```

## Links

Com essa estrutura, os links passaram a ser relativos √† l√≠ngua que est√°
sendo utilizada. Assim, precisamos modificar os links que existem nos arquivos
da pasta **_includes** e **_layouts**. Por exemplo, eu tenho o arquivo
**_includes/navbar.html** que cont√©m a barra de navega√ß√£o presente em
todo o site composta por links para a *homepage* e as principais p√°ginas.

Dado que marcamos as nossas p√°ginas usando Front Matter, fica f√°cil modificar
os links, uma vez que em todas as p√°ginas temos acesso √† vari√°vel **page** que
refer√™ncia a p√°gina atual.

{% highlight html %}
{% raw %}
<a href="{{ site.baseurl }}/{{ page.locale }}">
  Home
</a>
{% endraw %}
{% endhighlight %}

*Antes:*
```html
<a href="{{ site.baseurl }}">Home</a>
```

*Depois:*
```html
<a href="{{ site.baseurl }}/{{ page.locale }}">Home</a>
```

Ou seja, os links do site passar√£o a direcionar para as p√°ginas traduzidas
na l√≠ngua que o usu√°rio est√° usando.

## Artigos do Blog

Uma das principais vantagens de se permitir v√°rias l√≠nguas em seu site
est√° na possibilidade de ter um blog que atinge p√∫blicos diferentes. Voc√™
passa a ter a op√ß√£o de publicar textos que interessam ao p√∫blico de
uma l√≠ngua/regi√£o espec√≠fica ou at√© mesmo distribuir o mesmo conte√∫do em 
diversas l√≠nguas diferentes.

Para alcan√ßar essa flexibilidade, n√≥s vamos adicionar essas duas novas chaves
nos metadados de cada *post* (Front Matter):
- **locale** - l√≠ngua em que o texto do artigo est√° escrito (*en* ou *pt-br*)
- **lang-ref** - uma *string* que identifica unicamente um *post* para que
possamos encontrar *posts* equivalentes traduzidos em outras l√≠nguas. Ou seja,
um *post* em portugu√™s que tiver o mesmo *lang-ref* de outro *post* em ingl√™s
ser√£o textos equivalentes.

*en/_posts/2019-04-15-ruby-initialize-objects-with-a-hash.md*

```
layout: post
title: "Quick Note #1 - Initialize Ruby objects passing named arguments with a Hash"
lang-ref: ruby-initialize-objects-with-a-hash
locale: en
```

*pt-br/_posts/2019-04-15-ruby-initialize-objects-with-a-hash.md*

```
layout: post
title: "Nota R√°pida #1 - Inicializar objetos em Ruby passando argumentos nomeados com um Hash"
lang-ref: ruby-initialize-objects-with-a-hash
locale: pt-br
```

Altere o *layout* do seus posts para que seja poss√≠vel encontrar artigos
equivalentes em outras l√≠nguas:

*_layouts/post.html*

{% highlight markdown linenos %}
{% raw %}
---
layout: default
---
<article>
  <header id="main">
    <h1 id="{{ page.title | cgi_escape }}" class="title">{{ page.title }}</h1>
    <p class="meta">
    {{ page.date | date: "%B %-d, %Y" }}
    {% if page.author %} - {{ page.author }}{% endif %}
    </p>
  </header>
  <section class="post-content">
    <p class="center">
      {% assign posts=site.posts | where:"lang-ref", page.lang-ref | sort: 'locale' %}
      {% if posts.size > 1 %}
      <em><b>{{ site.data.translations['different-language'][page.locale] }}:</b></em>
        {% for t_post in posts %}
          {% if t_post.locale != page.locale %}
            <a href="{{ site.base-url }}{{ t_post.url }}">{{ site.data.languages[t_post.locale].icon }} {{ site.data.languages[t_post.locale].label }}</a>
          {% endif %}
        {% endfor %}
      {% endif %}
    </p>
    {{ content }}
  </section>
</article>
{% endraw %}
{% endhighlight %}

Algumas notas sobre o layout acima:
* Na linha **14**, n√≥s procuramos outros *posts* que possuam a mesma *lang-ref*
do *post* atual que est√° sendo renderizado.
* Caso existam *posts* em outras l√≠nguas equivalentes ao atual (linha **15**),
n√≥s apresentamos os links para as tradu√ß√µes dispon√≠veis.
* Repare que usamos na linha **16** a string *different-language* traduzida que
definimos anteriormente em *_data/translations.yml*
* Da mesma forma, na linha **19**, utilizamos a o emoji e o nome das l√≠nguas
que definimos em *_data/languages.yml*

## Blog e Pagina√ß√£o

Com as modificia√ß√µes feitas at√© agora temos praticamente dois blogs diferentes,
um composto por artigos na l√≠ngua portuguesa e outro com artigos em ingl√™s.
Por isso, dentro da pasta de cada l√≠ngua teremos uma p√°gina espec√≠fica para o
blog que carregar√° somente os artigos daquela l√≠ngua:

```shell
en/
  blog.html
pt-br/
  blog.html
```

*pt-br/blog.html*

```
---
layout: blog
locale: pt-br
pagination:
  enabled: true
  collection: posts
  locale: pt-br
---
```

*en/blog.html*

```
---
layout: blog
locale: en
pagination:
  enabled: true
  collection: posts
  locale: en
---
```

Os metadados que colocamos em **pagination** s√£o usados pelo plugin
`jekyll-paginate-v2`. Ele j√° consegue separar a pagina√ß√£o baseada no atributo
**locale** das p√°ginas. Dessa forma, o layout dos blogs fica da seguinte forma:

*_layouts/blog.html*

{% highlight markdown linenos %}
{% raw %}
<div class="posts">
    {% for post in paginator.posts %}
    <div class="post-teaser">
      <span>
        <header>
          <h1>
            <a class="post-link" href="{{ post.url | prepend: site.baseurl }}">
              {{ post.title }}
            </a>
          </h1>
          <p class="meta">
            {{ post.date | date: "%B %-d, %Y" }}
          </p>
        </header>
      </span>
    </div>
    {% endfor %}
  </div>

  {% if paginator.total_pages > 1 %}
    <div class="pagination">
      {% if paginator.previous_page %}
        <a href="{{ paginator.previous_page_path | prepend: site.baseurl | replace: '//', '/' }}" class="button" >
          <i class="fa fa-chevron-left"></i>
        </a>
      {% endif %}
      {% if paginator.next_page %}
        <a href="{{ paginator.next_page_path | prepend: site.baseurl | replace: '//', '/' }}" class="button" >
          <i class="fa fa-chevron-right"></i>
        </a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endraw %}
{% endhighlight %}

Algumas notas sobre o layout acima:
* Na lina **2**, percorremos os *posts* dispon√≠veis no *paginator*, que j√°
foi filtrado de acordo com os atributos do Front Matter definidos em *en/blog.html*
e *pt-br/blog.html*
* O bloco entre a linha **20** e a linha **33** adiciona os links para
navagar entre as p√°ginas dispon√≠veis, caso tenha mais de uma p√°gina de artigos
daquela l√≠ngua.

## Feed RSS

A constru√ß√£o do feed RSS segue a mesma l√≥gica da p√°gina do blog, ou seja,
teremos dois arquivos *feed.xml*, um em cada l√≠ngua.

*pt-br/feed.xml*

```
---
layout: feed
locale: pt-br
---
```

*en/feed.xml*

```
---
layout: feed
locale: en
---
```

*_layouts/feed.xml*

{% highlight markdown linenos %}
{% raw %}
<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>{{ site.theme_settings.title | xml_escape }}</title>
    <atom:link href="{{ "/feed.xml" | relative_url }}" rel="self" type="application/rss+xml"/>
    <link>{{ site.url }}{{ site.baseurl }}/</link>
    <description>{{ site.theme_settings.description | xml_escape }}</description>
    <pubDate>{{ site.time | date_to_rfc822 }}</pubDate>
    {% assign posts=site.posts | where:"locale", page.locale | sort: 'locale' %}
    {% for post in posts limit:15 %}
    <item>
        <title>{{ post.title | xml_escape }}</title>
        <link>{{ post.url | relative_url }}</link>
        <guid isPermaLink="true">{{ post.url | relative_url }}</guid>
        <description>{{ post.content | xml_escape }}</description>
        <pubDate>{{ post.date | date_to_rfc822 }}</pubDate>
    </item>
    {% endfor %}
  </channel>
</rss>
{% endraw %}
{% endhighlight %}

Esse layout possu√≠ a estrutura do Feed RSS.
A linha **9** √© a mais importante desse arquivo, pois ela atribui √† vari√°vel
**posts** somente os artigos que compartilham o mesmo **locale** do *feed*
que est√° sendo renderizado.

## Redirecionando a Homepage

Com as modifica√ß√µes feitas at√© agora, todo o conte√∫do do site estar√° sempre sob
o *namespace* de uma das duas l√≠nguas suportadas, ou seja, as URLs das p√°ginas
seguem uma das duas estruturas abaixo:

* https://arthurmde.me/en/page
* https://arthurmde.me/pt-br/page

No meu caso, eu coloquei a l√≠ngua inglesa como padr√£o para o meu site. Isso quer
dizer que sempre que algu√©m acessar a raiz do site - <https://arthurmde.me> - eu
quero redirecion√°-lo para <https://arthurmde.me/en/>

Para isso, usamos o plugin **jekyll-redirect-from**. Na raiz do projeto, criamos
a p√°gina *index.html* e definimos para onde ela ir√° redirecionar:

```
---
redirect_to: /en/
---
```

## Menu - Troca de Idiomas

Por fim, falta somente adicionar uma op√ß√£o no menu de navega√ß√£o que permita
ao usu√°rio mudar o idioma do site. No meu caso, eu acrescentei o seguinte trecho
no arquivo *_includes/navbar.html*, que cont√©m o menu de navega√ß√£o que √©
renderizado em todas as p√°ginas:

{% highlight markdown linenos %}
{% raw %}
<!-- Language Switcher -->
<div class="dropdown">
  <button class="dropbtn">{{ site.data.languages[page.locale].icon }} {{ site.languageNames[page.locale] }}</button>
  <div class="dropdown-content">
    {% for locale in site.languages %}
      {% if page.locale == locale %}
        {% assign class_name = 'active' %}
      {% else %}
        {% assign class_name = '' %}
      {% endif %}
      <a class="{{ class_name }}" href="{{ site.baseurl }}/{{ locale }}/">{{ site.languageNames[locale] }}</a>
    {% endfor %}
  </div>
</div>
{% endraw %}
{% endhighlight %}

* Na linha **3**, baseados na l√≠ngua da p√°gina atual, usamos o √≠cone/emoji
de bandeira que definimos em *_data/languages.yml* assim como o nome da l√≠ngua
que definimos em *_config.yml*. Esse bot√£o ter√° a l√≠ngua atual que est√°
sendo visualizada pelo usu√°rio.
* Caso o usu√°rio clique no bot√£o, temos um dropdown com as op√ß√µes de l√≠nguas
dispon√≠veis, que √© definida pela configura√ß√£o *site.languages*, conforme a
linha **5**
* Cada l√≠ngua dispon√≠vel ter√° um link para que o usu√°rio possa trocar a l√≠ngua
do site, como pode ser visto na linha **11** do c√≥digo acima.

No caso, usei as [classes do Bootstrap](https://getbootstrap.com/docs/4.0/components/dropdowns/) para criar o *dropdown*.

## Conclus√µes

Com a estrutura apresentada aqui nesse artigo fica bem f√°cil produzir conte√∫dos
para o seu site em diferentes l√≠nguas. Sinta-se livre para personalizar e
ajustar os c√≥digos apresentados para sua pr√≥pria necessidade.

Aproveite para ler o conte√∫do do meu site em [Ingl√™s](https://arthurmde.me/en/)
ou em [Portugu√™s](https://arthurmde.me/pt-br/) se voc√™ preferir.

Aproveite tamb√©m para assinar o meu feed em uma das duas l√≠nguas:
* <https://arthurmde.me/en/feed.xml>
* <https://arthurmde.me/pt-br/feed.xml>


Por favor, caso observe erros de escrita ou nos c√≥digos, me deixe saber atrav√©s
dos coment√°rios ou me envie um email.


<hr>

<span>**Let's get moving on!** üòâ</span>
